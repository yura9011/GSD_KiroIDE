---
phase: 1
level: 3
researched_at: 2026-01-20
---

# Phase 1 Research: Core Ralph Engine

## Questions Investigated

1. **Core Architecture**: How does the Ralph Loop work fundamentally?
2. **Implementation Details**: What are the key files and scripts needed?
3. **Integration with GSD**: How to adapt Ralph for our existing GSD framework?
4. **Cross-Platform Requirements**: Windows, Linux, Mac compatibility
5. **Quality Control**: How does backpressure validation work?
6. **Context Management**: How does Ralph maintain context hygiene?

## Findings

### Core Ralph Architecture

**The "Piloto Automático" Pattern:**
- **Before (GSD Clásico)**: Human is the pilot - writes `/execute`, waits, reads, writes `/verify`
- **Now (Ralph)**: Human is flight engineer - configures course (ROADMAP.md), starts engine (loop.sh), AI flies autonomously

**Three Phases, Two Prompts, One Loop:**
1. **Phase 1**: Define Requirements (Human + LLM conversation)
2. **Phase 2**: Planning Mode (Generate/update IMPLEMENTATION_PLAN.md)
3. **Phase 3**: Building Mode (Implement from plan, commit, update plan)

**Sources:**
- https://github.com/ghuntley/how-to-ralph-wiggum
- Original concept by Geoffrey Huntley (@GeoffreyHuntley)

**Recommendation:** Implement the three-phase approach with mode switching between planning and building.

### Key Files and Components

**Essential Files:**
- `loop.sh` - The autonomous execution engine (bash)
- `loop.ps1` - PowerShell equivalent for Windows
- `AGENTS.md` - Operational manual (60 lines max, operational only)
- `PROMPT_build.md` - Building mode template
- `PROMPT_plan.md` - Planning mode template
- `IMPLEMENTATION_PLAN.md` - Prioritized task list (generated by Ralph)

**File Purposes:**
- **loop.sh**: Outer loop control, feeds prompts to AI, manages iterations
- **AGENTS.md**: "Heart of the loop" - concise operational guide, project-specific commands
- **PROMPT_*.md**: Instructions loaded each iteration, different for planning vs building
- **IMPLEMENTATION_PLAN.md**: Shared state between iterations, persists on disk

**Sources:**
- Repository examples and templates
- Geoff's specific implementation patterns

**Recommendation:** Create all core files with GSD-specific adaptations.

### Loop Mechanics Deep Dive

**Outer Loop Control:**
```bash
while true; do
  cat "$PROMPT_FILE" | claude -p --dangerously-skip-permissions --model opus
  git push origin $(git branch --show-current)
  sleep 2
done
```

**Inner Loop Control (Single Task):**
1. **Orient**: Study specs/* and existing code
2. **Read Plan**: Study IMPLEMENTATION_PLAN.md
3. **Select**: Pick most important task
4. **Investigate**: Study relevant source code
5. **Implement**: Make changes using subagents
6. **Validate**: Run tests (backpressure)
7. **Update**: Mark task done in plan
8. **Commit**: Atomic git commit
9. **Exit**: Loop restarts with fresh context

**Context Hygiene Mechanism:**
- Each iteration starts fresh (new context window)
- State persists on disk via IMPLEMENTATION_PLAN.md
- No conversation history pollution
- Deterministic file loading each iteration

**Sources:**
- Loop mechanics section in repository
- Enhanced loop examples

**Recommendation:** Implement both outer and inner loop controls with GSD integration.

### Integration Points with GSD Framework

**Existing GSD Assets to Leverage:**
- `./scripts/validate-all.sh` - Perfect for backpressure validation
- `ROADMAP.md` structure - Can be adapted for IMPLEMENTATION_PLAN.md
- `STATE.md` - Session persistence mechanism
- Kiro hooks, skills, subagents - Enhanced Ralph capabilities

**Adaptation Strategy:**
1. **ROADMAP.md → IMPLEMENTATION_PLAN.md**: Convert checkbox format to Ralph's bullet-point format
2. **GSD Validation → Backpressure**: Use existing validation scripts as quality gates
3. **Kiro Subagents → Ralph Subagents**: Leverage context fork pattern for efficiency
4. **GSD Workflows → Ralph Prompts**: Adapt existing workflows into prompt templates

**Key Integration Points:**
- Planning Lock enforcement via hooks
- Automatic syntax validation via PostToolUse hooks
- Context-efficient operations via subagents
- Slash command integration for Ralph control

**Sources:**
- Current GSD framework analysis
- Kiro integration capabilities from previous milestone

**Recommendation:** Build Ralph as extension of GSD, not replacement.

### Cross-Platform Implementation

**Core Requirements:**
- Bash script for Linux/Mac (`loop.sh`)
- PowerShell script for Windows (`loop.ps1`)
- Claude CLI or equivalent AI interface
- Git for version control

**Platform-Specific Considerations:**
- **Windows**: PowerShell equivalent of bash loop
- **Linux/Mac**: Standard bash implementation
- **Cross-platform**: Shared prompt files and AGENTS.md

**Enhanced Loop Features:**
- Mode selection (plan/build)
- Max iterations support
- Automatic git push after each iteration
- Error handling and recovery

**Sources:**
- Enhanced loop examples in repository
- Cross-platform shell scripting patterns

**Recommendation:** Develop parallel bash and PowerShell implementations with shared templates.

### Backpressure Validation System

**Core Concept:**
Backpressure = Quality gates that prevent Ralph from marking tasks complete without proper validation.

**Implementation:**
- **AGENTS.md** specifies project-specific validation commands
- **PROMPT_build.md** requires validation before task completion
- **Validation failure** = Task not marked complete, loop continues
- **Validation success** = Task marked complete, commit created

**GSD Integration:**
```markdown
# AGENTS.md example
## Validation Commands
- Full validation: `./scripts/validate-all.sh`
- Syntax check: `npm run lint` (or equivalent)
- Tests: `npm test` (or equivalent)
```

**Quality Gates:**
- Syntax validation (linting)
- Test execution
- Build verification
- Custom project validations

**Sources:**
- Backpressure section in repository
- AGENTS.md examples

**Recommendation:** Integrate existing GSD validation scripts as backpressure mechanisms.

### Advanced Features and Enhancements

**Subagent Integration:**
- Up to 500 parallel Sonnet subagents for code analysis
- Opus subagents for complex reasoning
- Context fork pattern for efficiency

**LLM-as-Judge Validation:**
- Non-deterministic backpressure for subjective quality
- Binary pass/fail evaluation
- Multimodal support (text + vision)

**Work Branch Support:**
- Scoped planning for feature branches
- Work-focused IMPLEMENTATION_PLAN.md
- PR-ready workflow

**Sources:**
- Enhancements section in repository
- Advanced patterns and examples

**Recommendation:** Implement core features first, add enhancements in later phases.

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Architecture** | Three-phase approach (Requirements → Planning → Building) | Proven pattern from original Ralph implementation |
| **Core Files** | loop.sh, AGENTS.md, PROMPT_*.md, IMPLEMENTATION_PLAN.md | Essential components identified in research |
| **Cross-Platform** | Parallel bash/PowerShell implementation | Support Windows (PowerShell) and Unix (bash) |
| **Integration** | Extend GSD framework, don't replace | Leverage existing validation scripts and Kiro features |
| **Validation** | Use existing `./scripts/validate-all.sh` as backpressure | Proven GSD validation system |
| **Context Management** | Fresh context per iteration, disk-based state | Core Ralph principle for context hygiene |

## Patterns to Follow

- **Deterministic Setup**: Same files loaded each iteration (PROMPT.md + AGENTS.md + specs/*)
- **Disk-Based State**: IMPLEMENTATION_PLAN.md persists between iterations
- **Fresh Context**: Each loop iteration starts with clean context window
- **Backpressure Critical**: Validation must pass before task completion
- **Let Ralph Ralph**: AI decides implementation approach, human sets constraints
- **Plan is Disposable**: IMPLEMENTATION_PLAN.md can be regenerated anytime
- **Operational Only**: AGENTS.md contains commands, not status/progress
- **Single Task Focus**: One task per iteration, atomic commits

## Anti-Patterns to Avoid

- **Conversation Pollution**: Don't accumulate context across iterations
- **Status in AGENTS.md**: Keep operational commands only, status goes in IMPLEMENTATION_PLAN.md
- **Assuming Implementation**: Always search codebase before assuming functionality missing
- **Skipping Validation**: Never mark tasks complete without backpressure validation
- **Complex Orchestration**: Keep loop simple, let AI figure out what to do next
- **Prescriptive Implementation**: Specify WHAT to achieve, not HOW to implement
- **Bloated Prompts**: Keep AGENTS.md under 60 lines, prompts focused

## Dependencies Identified

| Package | Version | Purpose |
|---------|---------|---------|
| Claude CLI | Latest | AI interface for autonomous execution |
| Git | Any | Version control and atomic commits |
| Bash | 4.0+ | Linux/Mac loop implementation |
| PowerShell | 5.1+ | Windows loop implementation |
| Node.js | 18+ | For npm-based validation scripts (if applicable) |

## Technical Requirements

### Minimum Setup
- AI CLI tool (Claude, amp, codex, opencode, etc.)
- Git repository with existing validation scripts
- Cross-platform shell environment
- ROADMAP.md with checkbox tasks

### Recommended Setup
- Kiro IDE with hooks, skills, subagents
- Existing GSD validation scripts
- CI/CD integration capabilities
- Multi-core system for parallel subagent operations

## Risks and Mitigations

### Context Pollution
**Risk**: Long conversations degrade AI performance over time
**Mitigation**: Automatic session restarts after each task (core Ralph principle)

### Infinite Loops
**Risk**: AI gets stuck failing same validation repeatedly
**Mitigation**: 
- Error counting and max iterations
- Human intervention triggers
- Improved prompt engineering based on failure patterns

### Quality Control
**Risk**: AI marks tasks complete without proper validation
**Mitigation**: 
- Mandatory backpressure validation before completion
- Integration with existing GSD validation scripts
- Atomic commits for easy rollback

### Cross-Platform Issues
**Risk**: Scripts work on one platform but fail on others
**Mitigation**: 
- Parallel development of bash and PowerShell versions
- Shared template files for consistency
- Platform-specific testing

### Integration Complexity
**Risk**: Ralph conflicts with existing GSD workflows
**Mitigation**: 
- Build as extension, not replacement
- Maintain compatibility with manual workflows
- Gradual adoption path

## Implementation Strategy

### Phase 1 Approach
1. **Core Engine**: Implement basic loop.sh and loop.ps1
2. **Essential Files**: Create AGENTS.md, PROMPT_*.md templates
3. **GSD Integration**: Adapt ROADMAP.md format for IMPLEMENTATION_PLAN.md
4. **Validation**: Integrate existing validation scripts as backpressure
5. **Testing**: Verify cross-platform functionality

### Success Criteria for Phase 1
- [ ] loop.sh executes autonomous iterations
- [ ] loop.ps1 provides Windows compatibility
- [ ] AGENTS.md contains operational commands under 60 lines
- [ ] PROMPT_build.md and PROMPT_plan.md templates work
- [ ] Integration with `./scripts/validate-all.sh` as backpressure
- [ ] IMPLEMENTATION_PLAN.md format compatible with existing ROADMAP.md
- [ ] Cross-platform testing on Windows, Linux, Mac

## Ready for Planning

- [x] Core architecture understood (Three-phase Ralph approach)
- [x] Essential files identified (loop scripts, prompts, operational manual)
- [x] Integration strategy defined (Extend GSD, leverage existing validation)
- [x] Cross-platform requirements clarified (bash + PowerShell)
- [x] Backpressure mechanism designed (existing validation scripts)
- [x] Risk mitigation strategies identified
- [x] Implementation approach selected (autonomous execution with context hygiene)

## Next Steps

The research is complete and comprehensive. Ready to proceed with `/plan 1` to create detailed execution plans for implementing the Core Ralph Engine.

Key insight: Ralph Loop is not just "a loop that codes" - it's a complete paradigm shift from conversational AI to autonomous AI execution, with sophisticated context management and quality control mechanisms that align perfectly with GSD's empirical validation principles.